<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Task DAG (10 tasks)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 20px; font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 1400px; margin: 20px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        h1 { color: #333; margin: 0 0 10px 0; font-size: 28px; }
        .desc { color: #666; margin-bottom: 20px; }
        #graph { width: 100%; height: 600px; border: 1px solid #ddd; background: #fafafa; border-radius: 8px; }
        .node { cursor: pointer; }
        .node circle { stroke: #fff; stroke-width: 3px; transition: all 0.3s; }
        .node:hover circle { filter: brightness(1.1); }
        .node text { font-size: 12px; fill: white; text-anchor: middle; pointer-events: none; font-weight: 600; }
        .link { fill: none; stroke: #999; stroke-width: 2px; marker-end: url(#arrowhead); }
        .legend { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
        .legend-item { display: inline-block; margin-right: 20px; font-size: 14px; }
        .legend-color { display: inline-block; width: 16px; height: 16px; border-radius: 3px; margin-right: 6px; vertical-align: middle; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Task DAG (10 tasks)</h1>
        <div class="desc"></div>
        <svg id="graph"></svg>
        <div class="legend">
            <div class="legend-item"><span class="legend-color" style="background: #2ecc71;"></span>已完成</div>
            <div class="legend-item"><span class="legend-color" style="background: #3498db;"></span>执行中</div>
            <div class="legend-item"><span class="legend-color" style="background: gray;"></span>待执行</div>
            <div class="legend-item"><span class="legend-color" style="background: #e74c3c;"></span>失败</div>
        </div>
    </div>
    <script>
        var data = {"metadata": {"created_at": "2025-11-14T09:07:28.062249", "title": "Task DAG (10 tasks)", "description": "", "total_tasks": 10}, "nodes": [{"id": "req_analysis", "label": "分析用户需求，提取核心功能点", "status": "pending", "node_type": "task", "metadata": {"task_type": "analysis", "priority": 0, "full_prompt": "分析用户需求，提取核心功能点"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "market_research", "label": "研究竞品特性，识别差异化优势", "status": "pending", "node_type": "task", "metadata": {"task_type": "analysis", "priority": 0, "full_prompt": "研究竞品特性，识别差异化优势"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "system_design", "label": "设计系统架构，选择技术栈", "status": "pending", "node_type": "task", "metadata": {"task_type": "design", "priority": 0, "full_prompt": "设计系统架构，选择技术栈"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "ui_design", "label": "设计用户界面，制定交互规范", "status": "pending", "node_type": "task", "metadata": {"task_type": "design", "priority": 0, "full_prompt": "设计用户界面，制定交互规范"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "backend_api", "label": "实现后端REST API和数据库", "status": "pending", "node_type": "task", "metadata": {"task_type": "coding", "priority": 0, "full_prompt": "实现后端REST API和数据库"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "frontend_ui", "label": "实现前端页面和组件", "status": "pending", "node_type": "task", "metadata": {"task_type": "coding", "priority": 0, "full_prompt": "实现前端页面和组件"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "auth_module", "label": "实现用户认证与授权模块", "status": "pending", "node_type": "task", "metadata": {"task_type": "coding", "priority": 0, "full_prompt": "实现用户认证与授权模块"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "unit_tests", "label": "编写单元测试，确保代码质量", "status": "pending", "node_type": "task", "metadata": {"task_type": "testing", "priority": 0, "full_prompt": "编写单元测试，确保代码质量"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "integration_test", "label": "执行集成测试，验证模块协作", "status": "pending", "node_type": "task", "metadata": {"task_type": "testing", "priority": 0, "full_prompt": "执行集成测试，验证模块协作"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}, {"id": "deployment", "label": "部署到生产环境，配置监控", "status": "pending", "node_type": "task", "metadata": {"task_type": "deployment", "priority": 0, "full_prompt": "部署到生产环境，配置监控"}, "start_time": null, "end_time": null, "duration": null, "agent": null, "color": "#gray", "shape": null}], "edges": [{"source": "req_analysis", "target": "system_design", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "req_analysis", "target": "ui_design", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "market_research", "target": "ui_design", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "system_design", "target": "backend_api", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "ui_design", "target": "frontend_ui", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "system_design", "target": "auth_module", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "backend_api", "target": "unit_tests", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "frontend_ui", "target": "unit_tests", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "auth_module", "target": "unit_tests", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "backend_api", "target": "integration_test", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "frontend_ui", "target": "integration_test", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "unit_tests", "target": "deployment", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}, {"source": "integration_test", "target": "deployment", "label": null, "edge_type": "dependency", "metadata": {}, "color": null, "style": "solid"}]};
        
        var width = document.getElementById('graph').clientWidth;
        var height = 600;
        
        var svg = d3.select("#graph").attr("viewBox", [0, 0, width, height]);
        
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 25)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");
        
        var simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.edges).id(function(d) { return d.id; }).distance(150))
            .force("charge", d3.forceManyBody().strength(-500))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(40));
        
        var link = svg.append("g")
            .selectAll("path")
            .data(data.edges)
            .join("path")
            .attr("class", "link");
        
        var node = svg.append("g")
            .selectAll("g")
            .data(data.nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));
        
        node.append("circle")
            .attr("r", 30)
            .attr("fill", function(d) { return d.color || "#bdc3c7"; });
        
        node.append("text")
            .attr("dy", ".35em")
            .text(function(d) { return d.id; });
        
        node.append("title")
            .text(function(d) { 
                var text = d.label + " - Status: " + d.status;
                if (d.agent) text += " - Agent: " + d.agent;
                if (d.duration) text += " - Duration: " + d.duration.toFixed(2) + "s";
                return text;
            });
        
        simulation.on("tick", function() {
            link.attr("d", function(d) {
                var dx = d.target.x - d.source.x;
                var dy = d.target.y - d.source.y;
                var dr = Math.sqrt(dx * dx + dy * dy);
                return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
            });
            
            node.attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });
        });
        
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>